<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category, Sub-Category & Product Management</title>
    <link rel="stylesheet" href="payment.css">
    <!-- <link rel="stylesheet" href="./sidebar.css"> -->
</head>

<body>
  <div id="sidebar-container"></div>

<!-- <div class="sidebar"> -->
    <!-- <h2>Hotel Management</h2> -->
    <!-- <img src="../manage/360_F_200948189_QW7IVZCWlW0DJ0OBpKFln7TxO3j20CtG-removebg-preview (1).png"
        style="  height: 80px; width: 180px;" class="carousel-image"> -->

        <!-- <ul>
            <li>Category
              <ul>
                <li>Sub-Category
                  <ul>
                    <li>Product Management</li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul> -->
    <!-- <nav>
        <ul>
            <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
       
            
                <ul>
                    <li><a href="category.html"><i class="fas fa-calendar-check"></i> Category</a> -->
                      <!-- <ul>
                        <li> <i class="fas fa-calendar-check"></i> Sub-Category
                          <ul>
                            <li> <i class="fas fa-calendar-check"></i> Product Management</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul> -->
                <!-- </li>
                <li><a href="inventory.html"><i class="fas fa-calendar-check"></i> Inventory Management</a></li>
            <li><a href="guests.html"><i class="fas fa-users"></i>  Product Images </a></li>
            <li><a href="rooms.html"><i class="fas fa-bed"></i> Order & Delivery Management</a></li>
            <li><a href="housekeeping.html"><i class="fas fa-broom"></i> Payment Management</a></li>
            <li><a href="food.html"><i class="fas fa-utensils"></i> User Management</a></li>
            <li><a href="events.html"><i class="fas fa-calendar-alt"></i>  Inquiry & Support Management</a></li>
            <li><a href="staff.html"><i class="fas fa-user-tie"></i>  Inquiry & Support Management</a></li>
          
            <li><a href="#" id="logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </nav>


</div> -->

<div>
    <div class="form-container">
        <h1>Payment Management</h1>
        
        <!-- View Payment Details Section -->
        <section class="form-section">
            <h2>Payment Details</h2>
            <table class="payment-table">
                <thead>
                    <tr>
                      <th>Payment ID</th>
                      <th>Order ID</th>
                      <th>Transaction ID</th>
                      <th>Amount</th>
                      <th>Payment Method</th>
                      <th>Payment Status</th>
                      <th>Payment Date</th>
                      <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="payment-list">
                    <!-- Example of a Payment Row -->
                    <!-- More payment records will go here -->
                </tbody>
            </table>
        </section>

        <!-- Search Payment Section -->
        <section class="form-section">
            <h2>Search Payment</h2>
            <form>
                <!-- Transaction ID Search -->
                <label for="search-transaction-id">Transaction ID:</label>
                <input type="text" id="search-transaction-id" name="search-transaction-id" placeholder="Enter Transaction ID" />

                <!-- Payment ID Search -->
                <label for="search-payment-id">Payment ID:</label>
                <input type="text" id="search-payment-id" name="search-payment-id" placeholder="Enter Payment ID" />

                <!-- Payment Status Search -->
                <label for="search-payment-status">Payment Status:</label>
                <select id="search-payment-status" name="search-payment-status">
                    <option value="">Select Status</option>
                    <option value="Completed">Completed</option>
                    <option value="Failed">Failed</option>
                    <option value="Pending">Pending</option>
                </select>

                <button type="submit">Search</button>
            </form>
        </section>
    </div>
</div>
<script src ="include.js"></script>
<script>
  const API_URL = 'http://192.168.29.252:1000';
document.addEventListener("DOMContentLoaded", function () {
    const paymentList = document.getElementById("payment-list");
    const form = document.querySelector("form");

    // Fetch and display all payments initially
    fetchPayments();

    // Listen for form submission (filter)
    form.addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent page reload

        const transactionId = document.getElementById("search-transaction-id").value.trim().toLowerCase();
        const paymentId = document.getElementById("search-payment-id").value.trim();
        const paymentStatus = document.getElementById("search-payment-status").value.toLowerCase();

        fetchPayments(transactionId, paymentId, paymentStatus);
    });

    function fetchPayments(transactionId = "", paymentId = "", status = "") {
        fetch(`${API_URL}/payment_list`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok " + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                paymentList.innerHTML = ""; // Clear previous results

                const filteredPayments = data.filter(payment => {
                    const matchesTransactionId = !transactionId || payment.transaction_id.toLowerCase().includes(transactionId);
                    const matchesPaymentId = !paymentId || payment.payment_id.toString() === paymentId;
                    const matchesStatus = !status || payment.status.toLowerCase() === status;

                    return matchesTransactionId && matchesPaymentId && matchesStatus;
                });

                if (filteredPayments.length === 0) {
                    paymentList.innerHTML = `<tr><td colspan="9">No matching records found</td></tr>`;
                    return;
                }

                filteredPayments.forEach(payment => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${payment.payment_id}</td>
                        <td>${payment.order_id}</td>
                        <td>${payment.transaction_id}</td>
                        <td>â‚¹${payment.amount.toFixed(2)}</td>
                        <td>${payment.payment_method}</td>
                        <td>${payment.status}</td>
                        <td>${payment.payment_date || 'N/A'}</td>
                        <td>
                            <button class="edit-btn" data-id="${payment.payment_id}">Edit</button>
                            <button class="delete-btn" data-id="${payment.payment_id}">Delete</button>
                        </td>
                    `;
                    paymentList.appendChild(row);
                });

                attachButtonEvents();
            })
            .catch(error => {
                console.error("Error fetching payment data:", error);
            });
    }

    function attachButtonEvents() {
        // DELETE
        document.querySelectorAll(".delete-btn").forEach(button => {
            button.addEventListener("click", function () {
                const id = this.getAttribute("data-id");

                if (confirm("Are you sure you want to delete this payment?")) {
                    fetch(`${API_URL}/payment_list/${id}`, {
                        method: 'DELETE'
                    })
                    .then(res => res.json())
                    .then(response => {
                        alert(response.message || "Payment deleted");
                        fetchPayments();
                    })
                    .catch(err => console.error("Error deleting payment:", err));
                }
            });
        });

        // PUT (Update)
        document.querySelectorAll(".edit-btn").forEach(button => {
            button.addEventListener("click", function () {
                const id = this.getAttribute("data-id");
                const newStatus = prompt("Enter new status (Pending, Completed, Failed):");

                if (newStatus) {
                    fetch(`${API_URL}/payment_list/${id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: newStatus })
                    })
                    .then(res => res.json())
                    .then(response => {
                        alert(response.message || "Payment updated");
                        fetchPayments();
                    })
                    .catch(err => console.error("Error updating payment:", err));
                }
            });
        });
    }
});
  </script>
</body>


</html>