<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css'>
  <link rel='stylesheet' href='https://unicons.iconscout.com/release/v3.0.6/css/line.css'>
  <link rel="stylesheet" href="./style.css">
<style>
  :root {
    --dk-gray-100: #F3F4F6;
    --dk-gray-200: #E5E7EB;
    --dk-gray-300: #D1D5DB;
    --dk-gray-400: #9CA3AF;
    --dk-gray-500: #6B7280;
    --dk-gray-600: #4B5563;
    --dk-gray-700: #374151;
    --dk-gray-800: #1F2937;
    --dk-gray-900: #111827;
    --dk-dark-bg: #313348;
    --dk-darker-bg: #2a2b3d;
    --navbar-bg-color: #6f6486;
    --sidebar-bg-color: #252636;
    --sidebar-width: 250px;
    --status-active: #10B981;
    --status-canceled: #EF4444;
    --status-pending: #F59E0B;
}

/* Table Container */
.table-container {
    overflow-x: auto;
    max-width: 100%;
    margin: 1.5rem 0;
    background-color: var(--dk-dark-bg);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    border-radius: 8px;
}

/* Product Table Styling */
.product-table {
    width: 100%;
    min-width: 1200px;
    border-collapse: collapse;
    background-color: var(--dk-dark-bg);
}

.product-table th,
.product-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--dk-gray-700);
    color: var(--dk-gray-100);
    text-align: left;
    white-space: nowrap;
}

.product-table th {
    background-color: var(--dk-gray-700);
    color: var(--dk-gray-200);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
}

.product-table tr:hover {
    background-color: var(--dk-gray-700);
}

.product-table tr:nth-child(even) {
    background-color: var(--dk-darker-bg);
}

/* Status Indicators */
.product-table td[data-status] {
    display: flex;
    align-items: center;
    font-weight: 500;
}

.product-table td[data-status]::before {
    content: '';
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 0.75rem;
}

.product-table td[data-status="active"] { color: var(--status-active); }
.product-table td[data-status="active"]::before { background: var(--status-active); }

.product-table td[data-status="inactive"] { color: var(--status-canceled); }
.product-table td[data-status="inactive"]::before { background: var(--status-canceled); }

.product-table td[data-status="low-stock"] { color: var(--status-pending); }
.product-table td[data-status="low-stock"]::before { background: var(--status-pending); }

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 0.5rem;
}

.edit-btn {
    background-color: var(--navbar-bg-color);
    color: var(--dk-gray-100);
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.delete-btn {
    background-color: var(--navbar-bg-color);
    color: var(--dk-gray-100);
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.edit-btn:hover {
    background-color: #4f46e5;
    transform: translateY(-1px);
}

.delete-btn:hover {
    background-color: #dc2626;
    transform: translateY(-1px);
}

/* Responsive Design */
@media (max-width: 768px) {
    .table-container {
        margin: 1rem 0;
    }
    
    .product-table {
        min-width: 800px;
    }
    
    .product-table th,
    .product-table td {
        padding: 0.75rem;
        font-size: 0.85rem;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .edit-btn,
    .delete-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
    }
}

@media (max-width: 1200px) {
    .form-container {
        width: 80%;
        margin-left: auto;
        margin-right: auto;
    }
}

@media (max-width: 768px) {
    .form-container {
        width: 95%;
        padding: 1rem;
    }
    
    h1 {
        font-size: 1.5rem;
    }
    
    h2 {
        font-size: 1.2rem;
    }
}
</style>
</head>

<body>
  <div id="sidebar-container"></div>
  <section class="form-section">
    <h2>Product List</h2>
    <table class="product-table">
      <thead>
        <tr>
          <th>Product ID</th>
          <th>Name</th>
          <th>Category</th>
          <th>Sub-Category</th>
          <th>Price</th>
          <th>Discount</th>
          <th>Stock</th>
          <th>Status</th>
          <th>Tags</th>
          <th>Dimensions</th>
          <th>Specifications</th>
          <th>Image</th>
          <th>Weight</th>
          <!-- <th>Action</th> -->
        </tr>
      </thead>
      <tbody id="product-list">
        <!-- Example of a Product Row -->
        <!-- <tr>
          <td>#P12345</td>
          <td>Red Apple</td>
          <td>Fruits</td>
          <td>Apples</td>
          <td>$2.50</td>
          <td>0%</td>
          <td>100</td>
          <td>Active</td>
          <td>
            <button class="edit-btn" data-product-id="P12345" onclick="editProduct(this)">Edit</button>
            <button class="delete-btn" data-product-id="P12345" onclick="deleteProduct(this)">Delete</button>
          </td>
        </tr>
        <tr>
          <td>#P12346</td>
          <td>Wheat Flour</td>
          <td>Grains</td>
          <td>Flour</td>
          <td>$5.00</td>
          <td>10%</td>
          <td>50</td>
          <td>Inactive</td>
          <td>
            <button class="edit-btn" data-product-id="P12346" onclick="editProduct(this)">Edit</button>
            <button class="delete-btn" data-product-id="P12346" onclick="deleteProduct(this)">Delete</button>
          </td>
        </tr> -->
        <!-- More product records will go here -->
      </tbody>
    </table>
  </section>

  </body>
   <script src ="include.js"></script> 
   <script>
    const apiBaseUrl = "http://192.168.29.252:1000"; // Backend base URL

document.addEventListener("DOMContentLoaded", async () => {
  const parentCategorySelect = document.getElementById("parent-category");
  const subCategorySelect = document.getElementById("product-sub-category");
  const productList = document.getElementById("product-list");

  try {
    // Fetch categories
    const categoryResponse = await fetch(`${apiBaseUrl}/get-categories`);
    if (!categoryResponse.ok) throw new Error("Failed to fetch categories.");
    const categoryData = await categoryResponse.json();
    
    categoryData.categories.forEach(category => {
      const option = document.createElement("option");
      option.value = category.category_id;
      option.textContent = category.name;
      parentCategorySelect.appendChild(option);
    });

    // Fetch subcategories
    const subCategoryResponse = await fetch(`${apiBaseUrl}/get-subcategories`);
    if (!subCategoryResponse.ok) throw new Error("Failed to fetch subcategories.");
    const subCategoryData = await subCategoryResponse.json();

    // Filter subcategories on parent category change
    parentCategorySelect.addEventListener("change", () => {
      const selectedCategoryId = parentCategorySelect.value;
      subCategorySelect.innerHTML = "";

      const filteredSubcategories = subCategoryData.subcategories.filter(
        subcategory => subcategory.category_id == selectedCategoryId
      );

      if (filteredSubcategories.length === 0) {
        const noOption = document.createElement("option");
        noOption.value = "";
        noOption.textContent = "No subcategories available";
        subCategorySelect.appendChild(noOption);
      } else {
        filteredSubcategories.forEach(subcategory => {
          const option = document.createElement("option");
          option.value = subcategory.subcategory_id;
          option.textContent = subcategory.name;
          subCategorySelect.appendChild(option);
        });
      }
    });
  } catch (error) {
    console.error("Error fetching categories or subcategories:", error.message);
    // alert("Failed to load categories or subcategories. Please try again later.");
  }

  // Fetch and display products
  async function fetchProducts() {
  try {
    const response = await fetch(`${apiBaseUrl}/products`);
    if (!response.ok) throw new Error("Failed to fetch products");

    const data = await response.json();
    productList.innerHTML = "";

    data.products.forEach(product => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${product.product_id}</td>
        <td>${product.name}</td>
        <td>${product.category_name}</td>
        <td>${product.subcategory_name}</td>
        <td>${product.price} â‚¹</td>
        <td>${product.discount_percentage}%</td>
        <td>${product.stock_quantity}</td>
        <td>${product.status}</td>
        <td>${product.tags}</td>
        <td>${product.dimensions}</td>
        <td>${product.specifications}</td>
        <td><img src="${product.image_url || 'default.jpg'}" width="50" alt="Product Image"></td>
        <td>${product.weight}</td>
      `;
      productList.appendChild(row);
    });
  } catch (error) {
    console.error("Error fetching products:", error);
    alert("Failed to load products. Please try again later.");
  }
}

fetchProducts();

  // Delete product
  window.deleteProduct = async (productId) => {
    if (!confirm("Are you sure you want to delete this product?")) return;
    try {
      const response = await fetch(`${apiBaseUrl}/delete-product/${productId}`, { method: "DELETE" });
      if (!response.ok) throw new Error("Failed to delete product");
      fetchProducts();
    } catch (error) {
      console.error("Error deleting product:", error);
      alert("Failed to delete product. Please try again later.");
    }
  };

  //Edit product
  window.editProduct = async (productId) => {
    try {
      const response = await fetch(`${apiBaseUrl}/products?product_id=${productId}`);
      if (!response.ok) throw new Error("Failed to fetch product details");

      const product = await response.json();
      document.getElementById("product-name").value = product.name;
      document.getElementById("product-description").value = product.description;
      document.getElementById("parent-category").value = product.category_id;
      document.getElementById("product-sub-category").value = product.subcategory_id;
      document.getElementById("product-price").value = product.price;
      document.getElementById("product-discount").value = product.discount_percentage;
      document.getElementById("product-stock").value = product.stock_quantity;
      document.getElementById("product-status").value = product.status;
      document.getElementById("product-tags").value = product.tags;
      document.getElementById("product-dimensions").value = product.dimensions;
      document.getElementById("product-specifications").value = product.specifications;
      document.getElementById("product-weight").value = product.weight;

      document.querySelector("form").setAttribute("data-edit-id", productId);
    } catch (error) {
      console.error("Error fetching product details:", error);
      alert("Failed to fetch product details. Please try again later.");
    }
  };

  // Handle form submission
  document.querySelector("form").addEventListener("submit", async (event) => {
    event.preventDefault();
    const formData = new FormData(event.target);
    const editId = event.target.getAttribute("data-edit-id");
    const url = editId ? `${apiBaseUrl}/update-product/${editId}` : `${apiBaseUrl}/save-product`;
    const method = editId ? "PUT" : "POST";

    try {
      const response = await fetch(url, { method, body: formData });
      const result = await response.json();

      if (!response.ok) throw new Error(result.error || "Failed to save product");

      alert(result.message || "Product saved successfully!");
      event.target.reset();
      fetchProducts();
    } catch (error) {
      console.error("Error saving product:", error);
      alert("An error occurred: " + error.message);
    }
  });
});
   </script> 
  </html>