<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category, Sub-Category & Product Management</title>
    <link rel="stylesheet" href="order&delivery.css">
    <!-- <link rel="stylesheet" href="./sidebar.css"> -->
     
</head>

<body>
    <div id="sidebar-container"></div>
    <div>
        <div class="form-container">
            <!-- <h1>Order & Delivery </h1> -->

            <!-- View Orders Section -->
            <section class="form-section">
                <h2>View Order Details</h2>
                
                <div style="overflow-x: auto; max-width: 100%; width: 1800px; ">

                    <table class="order-table" style="border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>User ID</th>
                            <th>Products</th>
                            <!-- <th>product Image</th> -->
                            <th>Quantity</th>
                            <th>Price at Purchase</th>
                            <th>Total Amount</th>
                            <th>Payment Status</th>
                            <th>Order Status</th>
                            <th>Delivery Address</th>
                            <th>Contact Info</th>
                            <th>Delivery Time Preference</th>
                            <th>Billing Details</th>
                            <!-- <th>Actions</th> -->
                        </tr>
                    </thead>
                    <tbody id="order-list">
                        <!-- Orders will be dynamically inserted here -->
                    </tbody>
                </table>
                </div>
            </section>            
            <!-- Update Order Status -->
            <!-- <section class="form-section">
                <h2>Update Order Status</h2>
                <form>
                    <label for="order-id">Order ID:</label>
                    <input type="text" id="order-id" name="order-id" placeholder="Order ID" disabled>

                    <label for="order-status">Order Status:</label>
                    <select id="order-status" name="order-status">
                        <option value="pending">Pending</option>
                        <option value="shipped">Shipped</option>
                        <option value="delivered">Delivered</option>
                        <option value="canceled">Canceled</option>
                    </select>

                    <button type="submit">Update Status</button>
                </form>
            </section> -->

            <!-- Assign Delivery Task -->
            <!-- <section class="form-section">
                <h2>Assign Delivery Task</h2>
                <form>
                    <label for="delivery-partner">Delivery Partner:</label>
                    <select id="delivery-partner" name="delivery-partner">
                        <option value="partner1">Delivery Partner 1</option>
                        <option value="partner2">Delivery Partner 2</option>
                        <option value="partner3">Delivery Partner 3</option>
                    </select>

                    <label for="delivery-address">Delivery Address:</label>
                    <input type="text" id="delivery-address" name="delivery-address" placeholder="Delivery address"
                        disabled>

                    <label for="estimated-delivery-date">Estimated Delivery Date:</label>
                    <input type="date" id="estimated-delivery-date" name="estimated-delivery-date" required>

                    <label for="delivery-notes">Delivery Notes (optional):</label>
                    <textarea id="delivery-notes" name="delivery-notes" rows="4"
                        placeholder="Special delivery instructions"></textarea>

                    <button type="submit">Assign Delivery</button>
                </form>
            </section> -->
        </div>
    </div>


    <script src ="include.js"></script>

<script>
   const API_URL = 'http://127.0.0.1:1000';

document.addEventListener("DOMContentLoaded", () => {
    fetchOrders();
});

function fetchOrders() {
    fetch(`${API_URL}/admin/checkout`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            renderOrders(data);
        })
        .catch(error => {
            console.error("Error loading orders:", error);
            document.getElementById("order-list").innerHTML = `
                <tr><td colspan="13" class="error">Failed to load orders. Please try again later.</td></tr>
            `;
        });
}

function renderOrders(orders) {
    const orderList = document.getElementById("order-list");
    orderList.innerHTML = ""; // Clear existing rows

    if (!orders.length) {
        orderList.innerHTML = `<tr><td colspan="13">No orders found.</td></tr>`;
        return;
    }

    orders.forEach(order => {
        // For each product, show name, image, quantity, price in a single row
        const productNames = order.products.map(p => `<div>${p.product_name}</div>`).join("");
        const productImages = order.products.map(p =>
            `<div><img src="${p.product_image || 'img/default.jpg'}" alt="${p.product_name}" style="width:50px;height:50px;object-fit:cover;border-radius:6px;"></div>`
        ).join("");
        const productQuantities = order.products.map(p => `<div>${p.quantity}</div>`).join("");
        const productPrices = order.products.map(p => `<div>₹${p.price_at_purchase}</div>`).join("");

        const billing = order.billing_details || {};
        const billingDetails = `
            ${billing.first_name || ""} ${billing.last_name || ""}<br>
            ${billing.address || ""}, ${billing.city || ""}, ${billing.country || ""}, ${billing.postcode || ""}<br>
            <strong>Mobile:</strong> ${billing.mobile || ""}<br>
            <strong>Email:</strong> ${billing.email || ""}<br>
            <strong>Notes:</strong> ${billing.order_notes || "N/A"}
        `;

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${order.order_id}</td>
            <td>${order.user_id}</td>
            <td>${productNames}</td>
            <td>${productQuantities}</td>
            <td>${productPrices}</td>
            <td>₹${order.total_amount}</td>
            <td>${order.payment_status || "Paid"}</td>
            <td>${order.order_status}</td>
            <td>${order.delivery_address || "N/A"}</td>
            <td>${order.contact_info || "N/A"}</td>
            <td>${order.delivery_time_preference || "N/A"}</td>
            <td>${billingDetails}</td>
        `;

        orderList.appendChild(row);
    });
}

function viewOrderDetails(orderId) {
    showAlert(`View details for Order ID: ${orderId}`);
}
</script>

</body>

</html>