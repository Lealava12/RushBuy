<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>contacts</title>
    <link rel="stylesheet" href="user.css">
    <script src="include.js"></script>
</head>

<body>
    <div id="sidebar-container"></div>
    <div class="form-container">
        <!-- <h1>contacts</h1> -->

        <!-- View Inquiries Section -->
        <section class="form-section">
            <h2>Contact Information</h2>
            <table class="user-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Message</th>
                        <th>Action</th>
                        
                    </tr>
                </thead>
                <tbody id="all_contact">
                </tbody>
            </table>
        </section>
    </div>
    <script>
        // const API_BASE_URL = "http://lealavaecommerce.com/api";

        // Function to load contacts and display them in the table
        async function loadContacts() {
            try {
                // Fetch all contacts using GET method
                const response = await fetch(`${API_BASE_URL}/contacts`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const contacts = await response.json();
                const contactsTable = document.getElementById('all_contact');
                contactsTable.innerHTML = ''; // Clear current contact entries

                // Iterate over the fetched contacts and display them in the table
                contacts.forEach(contact => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${contact.id}</td>
                <td>${contact.name}</td>
                <td>${contact.email}</td>
                <td>${contact.phone}</td>
                <td>${contact.message}</td> <!-- Display message column -->
                <td>
                    <button class="btn btn-danger" onclick="deleteContact(${contact.id})">Delete</button>
                </td>
            `;
                    contactsTable.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading contacts:', error);
            }
        }
        // Function to delete a contact 
        // DELETE Contact Function
function deleteContact(id) {
    if (!id) {
        showAlert('Invalid contact ID.');
        return;
    }

    // Use the custom showConfirm function with a callback
    showConfirm('Are you sure you want to delete this contact?', () => {
        fetch(`${API_BASE_URL}/contacts/${id}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                showAlert('Contact deleted successfully!');
                loadContacts(); // Reload the contact list
            } else if (data.error && data.error.includes('not found')) {
                showAlert('Error: The contact you are trying to delete does not exist.');
            } else {
                showAlert(`Error: ${data.error}`);
            }
        })
        .catch(error => {
            showAlert('Error: Unable to connect to the server.');
            console.error('Delete Error:', error);
        });
    });
}

        // When the page loads, this will automatically load the contacts
        document.addEventListener('DOMContentLoaded', function () {
            loadContacts(); // Load contacts when the page loads
        });
    </script>
</body>

</html>